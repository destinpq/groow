# Caddyfile for GROOW E-Commerce Platform
# Backend on https://groow-api.destinpq.com (port 443) -> proxies to localhost:21440
# Frontend on https://groow.destinpq.com (port 443) -> proxies to localhost:21441

# Backend API Server
https://groow-api.destinpq.com {
    tls /etc/letsencrypt/live/groow.destinpq.com/fullchain.pem /etc/letsencrypt/live/groow.destinpq.com/privkey.pem
    
    # Add CORS headers for API access
    header {
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
        Access-Control-Allow-Headers "Origin, Content-Type, Accept, Authorization, X-Requested-With"
        Access-Control-Allow-Credentials "true"
    }
    
    # Handle CORS preflight requests
    @cors_preflight {
        method OPTIONS
    }
    respond @cors_preflight 204
    
    # Reverse proxy to the NestJS backend on port 21440
    reverse_proxy localhost:21440
}

# Frontend Server
https://groow.destinpq.com {
    tls /etc/letsencrypt/live/groow.destinpq.com/fullchain.pem /etc/letsencrypt/live/groow.destinpq.com/privkey.pem
    
    # Reverse proxy to the UMI frontend on port 21441
    reverse_proxy localhost:21441
}