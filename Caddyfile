# Caddyfile for GROOW E-Commerce Platform
# Backend API Server - Let NestJS handle CORS
groow-api.destinpq.com {
    # Remove all CORS headers - let NestJS handle them
    # Reverse proxy to the NestJS backend on port 3000
    reverse_proxy localhost:3000
}

# Frontend Server - Static files
groow.destinpq.com {
    root * /home/azureuser/Groow/groow/frontend/dist
    file_server
    
    # Handle client-side routing for SPA
    try_files {path} /index.html
    
    # Force cache reload for JS files
    header *.js Cache-Control "no-cache, no-store, must-revalidate"
    header *.js Pragma "no-cache"
    header *.js Expires "0"
    
    header Access-Control-Allow-Origin *
    header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization"
}